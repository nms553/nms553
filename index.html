<!DOCTYPE html>

<html>



  <head>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="preconnect" href="https://fonts.googleapis.com">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&display=swap" rel="stylesheet">

    <link href="https://stupid-fast.com/css.css" rel="stylesheet">

    <script src="https://www.stupid-fast.com/gviz.js"></script>



    <style>
      a {

        margin: 20px;

      }



      table {

        table-layout: fixed;

        border-collapse: collapse;

        width: 100%;



      }



      tr:nth-child(even) {

        background: #DFC;

      }



      td {

        font-size: 0.9em;
        padding: 0px 0px 0px 0px;

      }

      td:first-child {
        width: 33%;
        font-size: 0.9em;
      }

      td:nth-child(2) {
        width: 45%;
      }

      sup {
        font-size: 0.7em;
      }

      td:nth-child(3) {
        white-space: nowrap;
        font-size: 0.8em;
      }





      p {

        margin: 5px;

        padding: 0px;

        font-size: 0.9em;

      }

    </style>



  </head>



  <body id="body">

    <center>



      <a href="https://www.stupid-fast.com/" class="banner">

        <img src="https://www.stupid-fast.com/banner.png"></a>



      <div id="links"></div>



      <table>

        <tbody id="tbody">

        </tbody>

      </table>

      <br>
      <hr><br>

      <div id="flag" style="font-size: 3em;"></div>
      <main id="laps"></main>



    </center>





    <script>
      var key = "1jwadkJYYfBmf-SbjUokDV0S_yzC7gD39-jHxVatJfLU"



      gviz(key, "HOMEPAGE", "select *", function(result) {

        result.shift()

        result.shift()

        //console.log(result);

        result.forEach(function(item, index) {

          var el = document.createElement(item[1])

          el.href = item[2]

          el.innerText = item[0]

          el.className = item[6]

          el.target = item[4]

          el.style = item[5]

          links.appendChild(el)

        })





      })





      gviz(key, "PICKORDER", "select A, B, G order by G", function(result) {

        result.shift()

        //console.log(result);

        result.forEach(function(item) {

          var tr = tbody.insertRow()

          tr.id = item[0]

          var td = tr.insertCell()

          tr.insertCell()
          tr.insertCell()

          var sup = document.createElement("SUP")

          sup.innerHTML = item[1]

          td.append(sup)

        })

        getPlayerNames(result)

      })





      function getPlayerNames(pickorder) {

        gviz(key, "PLAYERS", "select A, B where C = true", function(result) {

          result.shift()

          //console.log(result);

          result.forEach(function(item) {

            var tr = document.getElementById(item[0])

            var td = tr.getElementsByTagName("TD")[0]

            var p = document.createElement("STRONG")

            p.style.display = "inline-block"

            p.innerHTML = item[1]



            td.prepend(p)

          })

          getDrivers()



        })

      }





      function getDrivers() {

        console.log("running")

        gviz(key, "DRIVERS", "select A, B, D, E", function(result) {

          result.shift()

          console.log(result);

          result.forEach(function(item) {

            try {

              var tr = document.getElementById(item[2])

              var p = document.createElement("P")

              p.innerHTML = item[1]

              var td = tr.getElementsByTagName("TD")[1]
              console.log(item[3])
              if (item[3]) {
                tr.getElementsByTagName("TD")[2].innerHTML += item[3]

              }

              td.append(p)

            } catch (err) {



            }



          })



        })

      }
      
      
      //FLAG DATA
      fetch("https://cf.nascar.com/cacher/2023/1/5270/lap-notes.json").then(function(x){return x.text();}).then(function(y) {
	var arr = JSON.parse(y)
	console.log(arr)
  
  var keys = Object.keys(arr.laps)
  
  keys.forEach(function(item) {
  	var p = document.createElement("P")
    
    p.innerHTML = "<b>Lap " + item + ": </b><br>" + arr.laps[item][0].Note + "<br><br>"
  	laps.prepend(p)
  })
  
  
})


fetch("https://cf.nascar.com/live/feeds/live-flag-data.json").then(x => x.text()).then(function(result) {
	var parse = JSON.parse(result)
	console.log(parse)
  var pop = parse.pop()
  console.log(pop)
  
  switch (pop.flag_state) {
  case 8:
  flag.innerText = "üè¥"
  break;
  
  case 1:
  flag.innerText = "üü¢"
  break;
  
  case 2:
  flag.innerText = "üü°"
  break;
  
  case 4: 
  flag.innerText = "üèÅ"
  }
})

    </script>









  </body>

</html>
