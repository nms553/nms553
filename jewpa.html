<!DOCTYPE html>
<html>

<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
  font-size: 1em;
  margin: auto;
  max-width: 400px;
  padding: 10px;
}

li,
span {
  margin: 5px;
}

form {
  display: none;
}

h1,
header {
  text-align: center;
}

#main {
  margin-top: 30px;
  margin-bottom: 30px;
	list-style-type: none;
}

ol ol {
	list-style-type: decimal;
}

select {
  display: block;
  margin-left: auto;
  margin-right: auto;
  margin-top: 15px;
}

details {
	margin-bottom: 50px;
}

li {
	color: blue;
	text-decoration: underline;
	cursor: pointer;
}


  </style>
  
  </head>
  
  <body>
    <h1>
  Jewpa
</h1>
<header id="#header">
  <input id="input" type="text" placeholder="your mom"><br>
  <button onclick="add()">Add new item
  </button>
  <button id="clean" onclick="clean()">
    Clear
  </button>
  <select>
    <option selected value="10">MAIN</option>
  </select>
</header>

<ol id="main"></ol>

<form method="post" action="https://script.google.com/macros/s/AKfycbzpZHMWb2YiY6-B1llGVlT7dmPAu_Su6wwDLoaUhYOoLbexG7-5/exec" target="dummy">
  <input type="hidden" id="html" name="html" />
  <input type="hidden" id="row" name="row" value="10" />
  <iframe name="dummy"></iframe>

</form>

<details>
  <summary>More</summary><a href="https://docs.google.com/spreadsheets/d/1DvaYXhcpPJvMFNDlDtx9oG-YGKfqtT6ZbPWqZIvaIxw/edit#gid=0" target="_blank">Spreadsheet</a>
	<a href="https://script.google.com/macros/s/AKfycbzpZHMWb2YiY6-B1llGVlT7dmPAu_Su6wwDLoaUhYOoLbexG7-5/exec" target="_blank">Script</a><br>
</details>
<script>
  var attr;
var gdata = [];
var gkey = "1DvaYXhcpPJvMFNDlDtx9oG-YGKfqtT6ZbPWqZIvaIxw"
var gtab = "1"
var gsheet = "https://spreadsheets.google.com/feeds/cells/" +
  gkey + "/" + gtab + "/public/full?alt=json"
var timeout = "ready";

$(document).ready(getJSON)

function getJSON() {
  $.getJSON(gsheet, data)
}

function data(result) {
  console.log(result.feed.entry)
  gdata = result.feed.entry;
  populate();
  $("#main > li").each(function() {
    var option = $("<option></option>").text($(this).text())
    $("select").append(option)
  })
}


function populate() {
  $("#main").html("")
  var row = $("select").val() - 1
  var htm = gdata[row].content.$t
  $("#main").html(htm)
}

function jewpa() {
  $("ol ol").toggleClass("bold")
  $("ol ol ol").toggle(function() {
    if ($(this).is(":hidden")) {
      $(".jewpa").text("Show & Edit")
      document.designMode = "off"
    } else {
      $(".jewpa").text("Hide")
      document.designMode = "on"
    }
  });
}

$(document).on('keydown', function(e) {

  if (e.keyCode == 9 && e.shiftKey) {
    e.preventDefault();
    document.execCommand("outdent")
  } else if (e.keyCode == 9) {
    e.preventDefault();
    document.execCommand("indent")
  } else if (e.which == 192) {
    e.preventDefault();
    document.execCommand("strikethrough")
  }

  if (timeout == "ready") {
    timeout = "wait"
    setTimeout(function() {
      save();
      $("body").toggleClass("green")
      timeout = "ready"
      setTimeout(function() {
        $("body").toggleClass("green")
      }, 125);
    }, 10000);
  } else {

  }



})


$(document).on('click', "#main > li:not(first-child)", function(e) {
  e.stopPropagation();
  $('#main').prepend($(this))
  save();
})

$(document).on('click', "#main > li:first-child", function(e) {
  e.stopPropagation();
  $('#main').append($(this))
  save();
})

$('#main').on('click', "li ol li:not(first-child)", function(e) {
  e.stopPropagation();
  $(this).parent('ol').prepend($(this))
  save();
})

$('#main').on('click', "li ol li:first-child", function(e) {
  e.stopPropagation();
  $(this).remove()
  save();
})



function add() {
  var input = $("input").val()
  var select = $("select").val()
  var li = $("<li></li>").html(input)
  var ol = $("<ol></ol>").html("")
	console.log(select)
  $(li).append(ol)
  if (select == "10") {
    $("#main").prepend(li)
    var option = $("<option></option>").text(input)
    $("select").prepend(option)
  } else {
    var doc = $('li:contains(' + select + ')').find('ol')[0]
    $(doc).append("<li>" + input + "</li>")
  }
  save();
  
}

function save() {
  var htm = $("#main").html()
  $("#html").val(htm)
  $("#input").val("");
  $("form").submit();
}

function clean() {
  $("#input").val("");
}

$("#input").on('keydown', function(e) {
  if (e.keyCode == 13) {
    e.preventDefault();
    add();
    
  }
})

  
    </script>
  </body>

</html>
