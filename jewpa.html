<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <style>
      body {
        font-size: 1em;
        margin: auto;
        width: 100%
        max-width: 600px;
        padding: 10px;
				text-align: center;
      }

      h1,
      header {
        text-align: center;
        margin-bottom: 20px;
      }

      details {
      	margin-top: 30px;
        margin-bottom: 50px;
				display: inline-block;
      }

      a {
        display: table;
        margin-top: 5px;
      }

      #div {
        margin: auto;
        text-align: center;
      }

      div div {
        display: inline-block;
        margin-left: auto;
        margin-right: auto;
        text-align: left;
      }

    </style>
  </head>

  <body>
    <h1>
      Jewpa
    </h1>
    <header id="#header">
      <input id="input" type="text" placeholder="your mom"><br>
      <button onclick="add()">Add new item
      </button>
      <button id="clean" onclick="clean()">
        Clear
      </button>
    </header>

    <div id="div">
      <div id="main" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
    </div>


    <form method="post" action="https://script.google.com/macros/s/AKfycbzpZHMWb2YiY6-B1llGVlT7dmPAu_Su6wwDLoaUhYOoLbexG7-5/exec" target="dummy" style="display: none;">
      <input type="hidden" id="html" name="html" />
      <iframe name="dummy"></iframe>

    </form>

    <details>
      <summary>More</summary><a href="https://docs.google.com/spreadsheets/d/1DvaYXhcpPJvMFNDlDtx9oG-YGKfqtT6ZbPWqZIvaIxw/edit#gid=0" target="_blank">Spreadsheet</a>
      <a href="https://script.google.com/macros/s/AKfycbzpZHMWb2YiY6-B1llGVlT7dmPAu_Su6wwDLoaUhYOoLbexG7-5/exec" target="_blank">Script</a><br>
	    https://github.com/nms553/nms553.github.io/edit/master/jewpa.html
    </details>

    <script>
      var attr;
      var gdata = [];
      var gkey = "1DvaYXhcpPJvMFNDlDtx9oG-YGKfqtT6ZbPWqZIvaIxw"
      var gtab = "1"
      var gsheet = "https://spreadsheets.google.com/feeds/cells/" +
        gkey + "/" + gtab + "/public/full?alt=json"
      var timeout = "ready";

      $(document).ready(getJSON)

      function getJSON() {
        $.getJSON(gsheet, data)
      }

      function data(result) {
        console.log(result.feed.entry)
        gdata = result.feed.entry;
        populate();
      }


      function populate() {
        $("#main").html("")
        gdata.forEach(function(item, index) {
          var a = $("<a></a>").text(item.gs$cell.$t)
            .attr("id", "id" + index)
            .attr("href", "javascript:")
            .attr("draggable", true)
            .attr("ondragstart", "drag(event)")
          $("#main").append(a)
        })
      }

      $("#main").on('click', "a:first-child", function(e) {
				e.stopPropagation();
        $("#main").append(this);
        save();
      })

      $("#main").on('click', "a:not(:first-child)", function(e) {
				e.stopPropagation();
        $("#main").prepend(this)
        save();
      })
			
			$("#input").keydown(function(e) {
        if (e.which == 13) {
					$("button:first-child").click();
					add();
				}
        
      })

      function add() {
        var input = $("input").val()
        var a = $("<a></a>").text(input)
          .attr("id", Date.now())
          .attr("href", "javascript:")
          .attr("draggable", true)
          .attr("ondragstart", "drag(event)")
					.css("background-color", "yellow")
        $("#main").prepend(a)
        save();
      }

      function save() {
        var listarray = [];
        $("#main a").each(function() {
          listarray.push($(this).text())
        })
        console.log(listarray)
        var str = JSON.stringify(listarray)
        console.log(str)
        $("#html").val(str)
        $("form").submit();
        $("#input").val("");
      }


      function allowDrop(ev) {
        ev.preventDefault();
      }

      function drag(ev) {
        ev.dataTransfer.setData("Text", ev.target.id);
        console.log(ev.target)
      }

      function drop(ev) {
        var data = ev.dataTransfer.getData("Text");
        //console.log(data)
        //console.log(ev.target)
        var htm = document.getElementById(data)
        $(htm).insertBefore(ev.target)
        ev.preventDefault();
        save();
      }
			
			/*
			var timeout;
			$('#main').on('mousedown', 'a', change2Input)
			$('#main').on('mouseup', 'a', function() {
				clearTimeout(timeout);
			})
			
			function change2Input(e) {
			e.stopPropagation();
				var a = this
				timeout = setTimeout(function(){
					var innerText = a.innerText
					$(a).text("")
					var input = $("<input>").val(innerText)
					$(a).append(input)
					$(input).focus();
					
				}, 3000);
			}
			
			$("#main").on('change', 'input:not(:first-child)', function(e) {
					var txt = $(this).val();
					var parent = $(this).parent()
					$(parent).html("").text(txt)
			})
			*/

    </script>

  </body>

</html>
