var playerlist = [""]
var tbody = document.getElementById("tbody")
var select = document.getElementById("select")
var playerspan = document.getElementById("playerspan")


$(document).ready(getPlayers)

function getPlayers() {
  $.get("https://script.google.com/macros/s/AKfycbzFxazXqTRgfA0z4iMM4ckDKPY3vDewKU556Sl0EphwZ2m6FAtwVELJO776omPrXValZg/exec", {
    sheet: "Players"
  }, function(result, status) {
    //console.log(result)
    var data = JSON.parse(result)
    console.log(data)

    data.forEach(function(item, index) {
      var opt = document.createElement("OPTION")
      opt.id = item.player
      opt.innerText = item.player
      select.add(opt)
      //console.log(item.player)
    })
    //console.log(playerlist)
    getURL()
  });
  //return playerlist
}

function getURL() {
  //console.log("getURL")
  var url = window.location.search
  console.log(url)
  var param = new URLSearchParams(url);
  var player = param.get("player")
  //console.log(player)
  if (!player) {
    player = "Nick"
  }

  document.getElementById(player).selected = true

  getDrivers()
}



function getDrivers() {
  console.log("getDrivers")
  $.get("https://script.google.com/macros/s/AKfycbzFxazXqTRgfA0z4iMM4ckDKPY3vDewKU556Sl0EphwZ2m6FAtwVELJO776omPrXValZg/exec", {
    sheet: "Drivers"
  }, function(result, status) {
    //console.log(result)
    var data = JSON.parse(result)
    //console.log(data)
    //document.write(data)

    data.forEach(function(item, index) {
      var label = document.createElement("LABEL")
      var cb = document.createElement("INPUT")
      var span = document.createElement("SPAN")
      var img = document.createElement("IMG")
      label.id = item.di
      span.innerText = item.driver
      cb.type = "checkbox"
      cb.name = item.di
      img.src = "https://stupid-fast.com/d/" + item.di + ".png"
      img.alt = ""
      img.width = "50"
      label.appendChild(cb)
      label.appendChild(img)
      label.appendChild(span)
      maindiv.appendChild(label)

    })
    getPicks()
  });

}

function getPicks() {
  $.get("https://script.google.com/macros/s/AKfycbzFxazXqTRgfA0z4iMM4ckDKPY3vDewKU556Sl0EphwZ2m6FAtwVELJO776omPrXValZg/exec", {
    sheet: "Picks"
  }, function(result, status) {
    //console.log(result)
    var data = JSON.parse(result)
    //console.log(data)
    //document.write(data)
    var selectvalue = select.value
    data.forEach(function(item, index) {
    var arr = [item.driver1, item.driver2]
    arr.forEach(function(jtem, jndex) {
    try {
    var label1 = document.getElementById(jtem)
      var span1 = label1.getElementsByTagName("span")[0]
      var cb1 = label1.getElementsByTagName("input")[0]
      var mark1 = document.createElement("mark")
      mark1.innerText = item.player
      label1.appendChild(mark1)
      //span1.classList.add("strike")
      if (item.player !== selectvalue) {
        cb1.disabled = true
      }
      cb1.checked = true
    } catch(e) {
    
    }
    })
    
      

    })
  });

}

function changePlayer(value) {
	var url = "https://www.stupid-fast.com/picks?player="
  url = url + value
	window.open(url, "_self");
}

function refreshPage(value) {
	var value = select.value
  setTimeout(function() {
    changePlayer(value)
  }, 1000);
}
