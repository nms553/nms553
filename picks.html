  <!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&display=swap" rel="stylesheet">
  <link href="https://stupid-fast.com/css.css" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  
  <style>
tr:nth-child(13) td {
  padding-bottom: 25px;
  border-bottom: 1px solid;
}

tr:nth-child(14) td {
  padding-top: 25px;
}

input[name="trashtalk"] {
  width: 170px;
}

</style>

</head>

<body>

  <a href="https://www.stupid-fast.com/" class="banner">
  <img src="https://www.stupid-fast.com/banner.png"></a>

<table id="table" border="1">
  <tr>
    <td>LOADING...</td>
  </tr>
</table>

<form action="https://script.google.com/macros/s/AKfycbxRJrxGeKwbSUxf3aFIinfquZJPucJf2Mhc61GDuEzVFsNbOWnS98dGH3KbiHkWU_Un_A/exec" method="post" target="iframe" onsubmit="delayFunc()">
  <iframe name="iframe" style="display: none;"></iframe>
  <br>
  <input type="text" name="trashtalk" placeholder="trashtalk...">
  <input type="hidden" name="player" value="">
  <input type="submit" id="submitbutton" value="Submit trashtalk" >
</form>
  
  <script>
    document.addEventListener("DOMContentLoaded", loadXMLDoc);

function loadXMLDoc() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function () {
    if (this.readyState == 4 && this.status == 200) {
      var obj = JSON.parse(this.responseText);
      console.log(obj);
      table.innerHTML = "";

      obj.Driver.forEach(function (item, index) {
        var tr = table.insertRow();
        var img = document.createElement("IMG");
        img.src = "https://stupid-fast.com/d/d" + item.number + ".png";
        img.width = "50";
        tr.insertCell().appendChild(img);
        tr.insertCell().innerText = item.driver;

        var select = document.createElement("SELECT");
        select.id = item.driverid;
        select.onchange = function () {
          submitPick(this.id, this.value);
        };
        var option = document.createElement("OPTION");
        //option.value = "";
        option.value = "d000";
        select.add(option);

        obj.Player.forEach(function (item, index) {
        	if (item.active == true) {
            var opt = document.createElement("OPTION");
            opt.innerText = item.player;
            opt.value = item.playerid;
            select.add(opt);
            }
        });

        tr.insertCell().appendChild(select);
      });

      obj.Driver.forEach(function (item, index) {

          var menu = document.getElementById(item.driverid);
          menu.value = item.playerid;

      });
    }
  };
  xhttp.open(
    "GET",
    "https://script.google.com/macros/s/AKfycbxWY4yfPYawPQlV60bP6pMoZbvW124OZSMf_ftGk3QkUUyuFoDvnClgScK3JXHyu--w/exec",
    true
  );
  xhttp.send();
}

function submitPick(id, value) {
  if (value !== "d000") {
    document.getElementsByName("player")[0].value = value;
  }
  
  

  var http = new XMLHttpRequest();
  http.open(
    "POST",
    "https://script.google.com/macros/s/AKfycbxWY4yfPYawPQlV60bP6pMoZbvW124OZSMf_ftGk3QkUUyuFoDvnClgScK3JXHyu--w/exec",
    true
  );
  http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  http.send("driver=" + id + "&player=" + value);
}

function delayFunc() {
  console.log("submitted")
  	var b = document.getElementById("submitbutton")
    var inp = document.getElementsByName("trashtalk")[0]
    b.disabled = true
    //inp.disabled = true
    setTimeout(function() {
    	b.disabled = false
        //inp.disabled = false
    }, 5000);
  }

  </script>

</body>

</html>

