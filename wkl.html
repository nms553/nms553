<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>


    </script>

    <style>
      fieldset {
        display: inline-block;
        width: 40%;
        min-width: 275px;
        margin: 20px;
        vertical-align: top;
      }

      html,
      body {
        font-family: sans-serif;
        font-size: 0.91em;
        max-width: 900px;
        margin: auto;
      }

      input {
        width: 90%;
        height: 50px;
        display: block;
        font-size: 1.5em;
        margin: 5%;
        background-color: lightblue;
      }

      details {
        margin: 2%;
      }

    </style>
  </head>

  <body>

    <input onchange="add(this.value)" placeholder="Enter new item">
    <fieldset>
      <legend>Unplaced</legend>
      <ul id="un">
      </ul>
    </fieldset>
    <hr>

    <fieldset class="left">
      <legend>Urgent and Important</legend>
      <ul id="b"></ul>
    </fieldset>
    <fieldset class="right">
      <legend>Important</legend>
      <ul id="i"></ul>
    </fieldset>
    <fieldset class="left">
      <legend>Urgent</legend>
      <ul id="u"></ul>
    </fieldset>
    <fieldset class="right">
      <legend>Not Urgent, Not Important</legend>
      <ul id="n"></ul>
    </fieldset>

    <details>
      <summary>Archive</summary>
      <ul id="arch"></ul>
    </details>


    <script>
      var gdata = [];
      var gkey = "1GmuPPMYLhYUZL0LRzOmlJ7MCTmgp9qUcFLr43wNfD7M"
      var gtab = "5"
      var gsheet = "https://spreadsheets.google.com/feeds/list/" +
        gkey + "/" + gtab + "/public/full?alt=json"
      var table1 = document.getElementById("0")
      var both = document.getElementById("1")
      var important = document.getElementById("2")
      var urgent = document.getElementById("3")
      var neither = document.getElementById("4")
      var transferarray = [];

      $(document).ready(function() {

        $.getJSON(gsheet, data)

        function data(result) {
          //console.log(result.feed.entry)
          gdata = result.feed.entry;
          transferarray = gdata;
          process();
        }


        $("ul").on("dblclick", 'li', function() {
          $(this).children("select").toggle();
          this.setAttribute("contenteditable", true)
          //this.setAttribute("onchange", "change(this);")
        });


      });

      function addnew(data) {
        transferarray = []
        transferarray[0] = data;
        //console.log(transferarray)
        process();
      }

      function process() {
        transferarray.forEach(function(i, n) {
          var dropdown = document.createElement("SELECT")
          dropdown.style.display = "none"
          var optionun = document.createElement("OPTION")
          var optionb = document.createElement("OPTION")
          var optioni = document.createElement("OPTION")
          var optionu = document.createElement("OPTION")
          var optionn = document.createElement("OPTION")
          var optionarch = document.createElement("OPTION")
          optionun.text = "❔ Unplaced"
          optionb.text = "1 - Urgent and Important"
          optioni.text = "2 - Important"
          optionu.text = "3 - Urgent"
          optionn.text = "4 - Not Urgent, Not Important"
          optionarch.text = "❌ Archive"
          optionun.value = "un"
          optionb.value = "b"
          optioni.value = "i"
          optionu.value = "u"
          optionn.value = "n"
          optionarch.value = "arch"

          //console.log(level)

          dropdown.add(optionb)
          dropdown.add(optioni)
          dropdown.add(optionu)
          dropdown.add(optionn)
          dropdown.add(optionun)
          dropdown.add(optionarch)
          dropdown.setAttribute("onchange", "change(this.parentElement)")

          var level;
          var place;
          var li;

          try {
            place = document.getElementById(i.gsx$level.$t)
            level = eval("option" + i.gsx$level.$t)
            level.setAttribute("selected", true)

          } catch {
            place = document.getElementById("arch")
            level = eval("option" + "arch")
          } finally {
            level.setAttribute("selected", true)


            li = document.createElement("LI")

            li.textContent = i.gsx$i.$t
            li.id = i.gsx$id.$t
            li.setAttribute("data-index", n)
            var spaces =
              li.appendChild(dropdown)
            place.appendChild(li)
          }

        })
      }

      function change(that) {
        var li = that
        var el = that.getElementsByTagName('SELECT')[0]
        document.getElementById(el.value).appendChild(li)
        var getarray = gdata[li.getAttribute("data-index")]
        getarray.gsx$level.$t = el.value
        getarray.gsx$i.$t = that.firstChild.data
        console.log(getarray)

        autosave();
        $(el).toggle();
      }

      function autosave() {

        $("#myinput").val(JSON.stringify(gdata))
        $("#myform").submit()

      }

      function add(that) {
        var datenow = Date.now()
        var len = gdata.length
        var additem = {
          "gsx$i": {
            $t: that
          },
          "gsx$level": {
            $t: "un"
          },
          "gsx$id": {
            $t: datenow
          }
        }

        //console.log(additem)
        gdata.push(additem)


        autosave();
        addnew(additem);
        document.getElementById(datenow).setAttribute("data-index", len)
        $("input").val("")
      }

    </script>

    <form id="myform" action="https://script.google.com/macros/s/AKfycbw9AU-C4EW_G790ffPGWplypOvGBehxtXj5VFf2wr_KS_GutyM-/exec" method="post" target="dummy">
      <input type="hidden" id="myinput" name="one">

    </form>


    <iframe name="dummy" style="display: none;"></iframe>

    <footer>
      <a href="https://github.com/nms553/nms553.github.io/edit/master/wkl.html">GitHub</a>
      <a href="https://docs.google.com/spreadsheets/d/1GmuPPMYLhYUZL0LRzOmlJ7MCTmgp9qUcFLr43wNfD7M/edit#gid=1132993977">Sheets</a>
    </footer>
  </body>

</html>
