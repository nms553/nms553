<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>

    </script>
    <style>
      html,
      body {
        max-width: 500px;
        margin: auto;
      }

      td {
        width: 10%;
        text-align: center;
      }

      td:first-child {
        width: 80%;
        text-align: left;
      }

      table {
        width: 100%;
      }

      input {
        width: 100%;
        height: 50px;
        display: block;
        font-size: 1.5em;
      }

      .submit {
        height: 4em;
        width: 100%;
      }

    </style>
  </head>

  <body>
    <br>
    <input>
    <button class="submit" onclick="add()">Add</button>
    <hr>
    <h3>Unplaced</h3>
    <table id="0" border="1" bgcolor="lightyellow"></table>
    <hr>
    <h3>Today</h3>
    <table id="1" border="1"></table>
    <hr>
    <h3>Tomorrow</h3>
    <table id="2" border="1"></table>
    <hr>
    <h3>Two Days</h3>
    <table id="3" border="1"></table>
    <hr>
    <h3>This Week</h3>
    <table id="4" border="1"></table>
    <hr>
    <h3>No Date</h3>
    <table id="5" border="1"></table>


    <script>
      var gdata = [];
      var gkey = "1GmuPPMYLhYUZL0LRzOmlJ7MCTmgp9qUcFLr43wNfD7M"
      var gtab = "5"
      var gsheet = "https://spreadsheets.google.com/feeds/list/" +
        gkey + "/" + gtab + "/public/full?alt=json"
      var table0 = document.getElementById("0")
      var table1 = document.getElementById("1")
      var table2 = document.getElementById("2")
      var table3 = document.getElementById("3")
      var table4 = document.getElementById("4")
      var table5 = document.getElementById("5")
      $(document).ready(function() {

        $.getJSON(gsheet, data)

      });

      function data(result) {
        //console.log(result.feed.entry)
        gdata = result.feed.entry;
        process();
        return result;
      }

      function process() {
        table0.innerHTML = "";
        table1.innerHTML = "";
        table2.innerHTML = "";
        table3.innerHTML = "";
        table4.innerHTML = "";
        table5.innerHTML = "";
        gdata.forEach(function(i, index) {
          var upbtn = document.createElement("BUTTON")
          upbtn.setAttribute("onclick", "up(this)")
          upbtn.innerText = "↑"
          upbtn.setAttribute("data-id", index)
          var dwnbtn = document.createElement("BUTTON")
          dwnbtn.setAttribute("onclick", "dwn(this)")
          dwnbtn.setAttribute("data-id", index)
          dwnbtn.innerText = "↓"
          try {
            var tableno = document.getElementById(i.gsx$level.$t)
            var row = tableno.insertRow()
            row.insertCell(0).innerHTML = i.gsx$i.$t
            row.insertCell(1).appendChild(dwnbtn)
            row.insertCell(1).appendChild(upbtn)
            upbtn.class = i.gsx$level.$t;
            dwnbtn.class = i.gsx$level.$t;
          } catch {} finally {}


          //console.log(i)
        });


      }





      function up(that) {

        var level = that.class
        console.log(level)
        level = parseInt(level)
        level--

        var dat = that.getAttribute("data-id")
        //console.log(dat)

        gdata[dat].gsx$level.$t = level;
        process();
        autosave();
      }

      function dwn(that) {

        var level = that.class
        console.log(level)
        level = parseInt(level)
        level++

        var dat = that.getAttribute("data-id")
        //console.log(dat)

        gdata[dat].gsx$level.$t = level;
        process();
        autosave();
      }

      function autosave() {

        $("#myinput").val(JSON.stringify(gdata))
        $("#myform").submit()

      }

      function add() {
        var additem = {
          "gsx$i": {
            $t: $("input").val()
          },
          "gsx$level": {
            $t: "0"
          }


        }
        //console.log(additem)
        gdata.push(additem)
        //console.log(gdata)
        autosave();
        process();
        $("input").val("")
      }

    </script>

    <form id="myform" action="https://script.google.com/macros/s/AKfycbw9AU-C4EW_G790ffPGWplypOvGBehxtXj5VFf2wr_KS_GutyM-/exec" method="post" target="dummy">
      <input type="hidden" id="myinput" name="one">

    </form>


    <iframe name="dummy" style="display: none;"></iframe>

    <footer>
      <br>
      <hr><br>
      <a href="https://docs.google.com/spreadsheets/d/1GmuPPMYLhYUZL0LRzOmlJ7MCTmgp9qUcFLr43wNfD7M/edit#gid=1132993977" target="_blank">GSheet</a>
      -
      <a href="https://github.com/nms553/nms553.github.io/edit/master/wkl.html" target="_blank">GitHub</a>
    </footer>
  </body>

</html>
