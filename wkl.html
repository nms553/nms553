<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>


    </script>

    <style>
      div {
        display: inline-block;
        border: 1px solid;
        width: 300px;
        margin: 20px;
      }

      div {
        vertical-align: top;

      }

      html,
      body {
        font-family: sans-serif;
        font-size: 0.91em;
      }

      input {
        width: 90%;
        height: 50px;
        display: block;
        font-size: 1.5em;
      }

    </style>
  </head>

  <body>
    <input onchange="add(this.value)" placeholder="Enter new item">
    <div>Unplaced
      <ul id="un">
      </ul>
    </div>
    <hr>

    <div class="left">Urgent and Important<ul id="b"></ul>
    </div>
    <div class="right">Important<ul id="i"></ul>
    </div>
    <div class="left">Urgent<ul id="u"></ul>
    </div>
    <div class="right">Not Urgent, Not Important<ul id="n"></ul>
    </div>

    <details>
      <summary>Archive</summary>
      <ul id="arch"></ul>
    </details>


    <script>
      var gdata = [];
      var gkey = "1GmuPPMYLhYUZL0LRzOmlJ7MCTmgp9qUcFLr43wNfD7M"
      var gtab = "5"
      var gsheet = "https://spreadsheets.google.com/feeds/list/" +
        gkey + "/" + gtab + "/public/full?alt=json"
      var table1 = document.getElementById("0")
      var both = document.getElementById("1")
      var important = document.getElementById("2")
      var urgent = document.getElementById("3")
      var neither = document.getElementById("4")
      var transferarray = [];

      $(document).ready(function() {

        $.getJSON(gsheet, data)

        function data(result) {
          //console.log(result.feed.entry)
          gdata = result.feed.entry;
          transferarray = gdata;
          process();
        }


        $("ul").on("dblclick", 'li', function() {
          $(this).children("select").toggle();
        });


      });

      function addnew(data) {
        transferarray = []
        transferarray[0] = data;
        //console.log(transferarray)
        process();
      }

      function process() {
        transferarray.forEach(function(i, n) {
          var dropdown = document.createElement("SELECT")
          dropdown.style.display = "none"
          var optionun = document.createElement("OPTION")
          var optionb = document.createElement("OPTION")
          var optioni = document.createElement("OPTION")
          var optionu = document.createElement("OPTION")
          var optionn = document.createElement("OPTION")
          var optionarch = document.createElement("OPTION")
          optionun.text = "Unplaced"
          optionb.text = "Urgent and Important"
          optioni.text = "Important"
          optionu.text = "Urgent"
          optionn.text = "Not Urgent, Not Important"
          optionarch.text = "Archived"
          optionun.value = "un"
          optionb.value = "b"
          optioni.value = "i"
          optionu.value = "u"
          optionn.value = "n"
          optionarch.value = "arch"

          //console.log(level)
          dropdown.add(optionun)
          dropdown.add(optionb)
          dropdown.add(optioni)
          dropdown.add(optionu)
          dropdown.add(optionn)
          dropdown.add(optionarch)
          dropdown.setAttribute("onchange", "change(this)")

          var level;
          var place;
          var li;

          try {
            place = document.getElementById(i.gsx$level.$t)
            level = eval("option" + i.gsx$level.$t)
            level.setAttribute("selected", true)

          } catch {
            place = document.getElementById("arch")
            level = eval("option" + "arch")
          } finally {
            level.setAttribute("selected", true)


            li = document.createElement("LI")

            li.textContent = i.gsx$i.$t
            li.id = n
            li.appendChild(dropdown)
            place.appendChild(li)
          }

        })
      }

      function change(that) {
        var li = that.parentElement;
        document.getElementById(that.value).appendChild(li)
        var getarray = gdata[li.id]
        getarray.gsx$level.$t = that.value
        //console.log(getarray)
        autosave();
      }

      function autosave() {

        $("#myinput").val(JSON.stringify(gdata))
        $("#myform").submit()

      }

      function add(that) {
        var additem = {
          "gsx$i": {
            $t: that
          },
          "gsx$level": {
            $t: "un"
          }
        }
        //console.log(additem)
        gdata.push(additem)


        autosave();
        addnew(additem);
        $("input").val("")
      }

    </script>

    <form id="myform" action="https://script.google.com/macros/s/AKfycbw9AU-C4EW_G790ffPGWplypOvGBehxtXj5VFf2wr_KS_GutyM-/exec" method="post" target="dummy">
      <input type="hidden" id="myinput" name="one">

    </form>


    <iframe name="dummy" style="display: none;"></iframe>
  </body>

</html>
