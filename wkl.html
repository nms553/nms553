<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>

    </script>
    <style>
      html,
      body {
        max-width: 500px;
        margin: auto;
      }

      td:not(:first-child) {
        width: 30px;
        text-align: center;
      }

      td:first-child {
        text-align: left;
      }

      table {
        width: 100%;
      }

      input {
        width: 100%;
        height: 50px;
        display: block;
        font-size: 1.5em;
      }

      .submit {
        height: 4em;
        width: 100%;
      }

    </style>
  </head>

  <body>
    <br>
    <input>
    <button class="submit" onclick="add()">Add</button>
    <hr>
    <h3>Unplaced</h3>
    <table id="0" border="1" bgcolor="lightyellow"></table>
    <hr>
    <h3>Today</h3>
    <table id="1" border="1"></table>
    <hr>
    <h3>Tomorrow</h3>
    <table id="2" border="1"></table>
    <hr>
    <h3>Two Days</h3>
    <table id="3" border="1"></table>
    <hr>
    <h3>This Week</h3>
    <table id="4" border="1"></table>
    <hr>
    <h3>No Date</h3>
    <table id="5" border="1"></table>


    <script>
      var gdata = [];
      var gkey = "1GmuPPMYLhYUZL0LRzOmlJ7MCTmgp9qUcFLr43wNfD7M"
      var gtab = "5"
      var gsheet = "https://spreadsheets.google.com/feeds/list/" +
        gkey + "/" + gtab + "/public/full?alt=json"
      var table0 = document.getElementById("0")
      var table1 = document.getElementById("1")
      var table2 = document.getElementById("2")
      var table3 = document.getElementById("3")
      var table4 = document.getElementById("4")
      var table5 = document.getElementById("5")
      $(document).ready(function() {

        $.getJSON(gsheet, data)

      });

      function data(result) {
        //console.log(result.feed.entry)
        gdata = result.feed.entry;
        process();
        return result;
      }

      function process() {
        table0.innerHTML = "";
        table1.innerHTML = "";
        table2.innerHTML = "";
        table3.innerHTML = "";
        table4.innerHTML = "";
        table5.innerHTML = "";
        gdata.forEach(function(i, index) {
          var upbtn = document.createElement("BUTTON")
          upbtn.setAttribute("onclick", "up(this)")
          upbtn.innerText = "↑"
          upbtn.setAttribute("data-id", index)
          var dwnbtn = document.createElement("BUTTON")
          dwnbtn.setAttribute("onclick", "dwn(this)")
          dwnbtn.setAttribute("data-id", index)
          dwnbtn.innerText = "↓"
          var xbtn = document.createElement("BUTTON")
          xbtn.setAttribute("onclick", "del(this)")
          xbtn.setAttribute("data-id", index)
          xbtn.innerText = "X"
          var select = document.createElement("SELECT")
          var opt0 = document.createElement("OPTION")
          var opt1 = document.createElement("OPTION")
          var opt2 = document.createElement("OPTION")
          var opt3 = document.createElement("OPTION")
          var opt4 = document.createElement("OPTION")
          var opt5 = document.createElement("OPTION")
          var optx = document.createElement("OPTION")
          //var opt6 = document.createElement("OPTION")
          optx.text = "";
          opt0.text = "unplaced";
          opt1.text = "today";
          opt2.text = "tomorrow";
          opt3.text = "2 days";
          opt4.text = "this week";
          opt5.text = "no date";
          optx.setAttribute("selected", true)
          opt0.value = "0"
          opt1.value = "1"
          opt2.value = "2"
          opt3.value = "3"
          opt4.value = "4"
          opt5.value = "5"

          //opt6.text = 0;
          select.appendChild(optx)
          select.appendChild(opt1)
          select.appendChild(opt2)
          select.appendChild(opt3)
          select.appendChild(opt4)
          select.appendChild(opt5)
          select.appendChild(opt0)
          //select.add(document.createElement("OPTION").innerText = 1)
          //select.add(document.createElement("OPTION").innerText = 2)
          //select.add(document.createElement("OPTION").innerText = 3)
          //select.add(document.createElement("OPTION").innerText = 4)
          //select.add(document.createElement("OPTION").innerText = 5)
          select.setAttribute("onchange", "jump(this)")
          select.setAttribute("data-id", index)
          try {
            var tableno = document.getElementById(i.gsx$level.$t)
            var row = tableno.insertRow()
            var cell0 = row.insertCell()
            cell0.setAttribute("ondblclick", "edit(this)")
            cell0.innerHTML = i.gsx$i.$t
            cell0.setAttribute("data-id", index)
            row.insertCell().appendChild(select)
            row.insertCell().appendChild(dwnbtn)
            row.insertCell().appendChild(upbtn)
            row.insertCell().appendChild(xbtn)

            upbtn.class = i.gsx$level.$t;
            dwnbtn.class = i.gsx$level.$t;
          } catch {} finally {}


          //console.log(i)
        });


      }





      function up(that) {

        var level = that.class
        console.log(level)
        level = parseInt(level)
        level--

        var dat = that.getAttribute("data-id")
        //console.log(dat)

        gdata[dat].gsx$level.$t = level;
        process();
        autosave();
      }

      function dwn(that) {

        var level = that.class
        console.log(level)
        level = parseInt(level)
        level++

        var dat = that.getAttribute("data-id")
        //console.log(dat)

        gdata[dat].gsx$level.$t = level;
        process();
        autosave();
      }

      function del(that) {

        var level = that.class
        //console.log(level)
        level = -1

        var dat = that.getAttribute("data-id")
        //console.log(dat)

        gdata[dat].gsx$level.$t = level;
        process();
        autosave();
      }

      function jump(that) {
        var dat = that.getAttribute("data-id")
        gdata[dat].gsx$level.$t = that.value;
        process();
        autosave();
      }

      function autosave() {

        $("#myinput").val(JSON.stringify(gdata))
        $("#myform").submit()

      }

      function add() {
        var additem = {
          "gsx$i": {
            $t: $("input").val()
          },
          "gsx$level": {
            $t: "0"
          }


        }
        //console.log(additem)
        gdata.push(additem)
        //console.log(gdata)
        autosave();
        process();
        $("input").val("")
      }

      function edit(that) {
        that.setAttribute("contenteditable", true)
        var button = document.createElement("BUTTON")
        var dat = that.getAttribute("data-id")
        button.setAttribute("onclick", "change(this.parentElement)")
        button.innerHTML = "✔"
        button.setAttribute("display", "float: right;")
        var br = document.createElement("BR")
        that.appendChild(br)
        that.appendChild(button)
      }

      function change(that) {
        var dat = that.getAttribute("data-id")
        gdata[dat].gsx$i.$t = that.firstChild.data;

        process();
        autosave();

      }

    </script>

    <form id="myform" action="https://script.google.com/macros/s/AKfycbw9AU-C4EW_G790ffPGWplypOvGBehxtXj5VFf2wr_KS_GutyM-/exec" method="post" target="dummy">
      <input type="hidden" id="myinput" name="one">

    </form>


    <iframe name="dummy" style="display: none;"></iframe>

    <footer>
      <br>
      <hr><br>
      <a href="https://docs.google.com/spreadsheets/d/1GmuPPMYLhYUZL0LRzOmlJ7MCTmgp9qUcFLr43wNfD7M/edit#gid=1132993977" target="_blank">GSheet</a>
      -
      <a href="https://github.com/nms553/nms553.github.io/edit/master/wkl.html" target="_blank">GitHub</a>
    </footer>
  </body>

</html>
