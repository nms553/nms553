<!DOCTYPE html>
<html>

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>

    </script>
    <style>
      td {
        width: 10%;
        text-align: center;
      }

      td:first-child {
        width: 80%;
        text-align: left;
      }

      table {
        width: 100%;
      }
      
      input {
        width: 100%;
        height: 50px;
        display: block;
        font-size: 1.5em;
      }
      
      .submit {
        height: 4em;
        width: 100%
      }

    </style>
  </head>

  <body>
<br>
    <input>
    <button class="submit" onclick="add()">Add</button>
    <hr>
    <table id="1" border="1"></table>
    <hr>
    <table id="2" border="1"></table>
    <hr>
    <table id="3" border="1"></table>

    <script>
      var gdata = [];
      var gkey = "1GmuPPMYLhYUZL0LRzOmlJ7MCTmgp9qUcFLr43wNfD7M"
      var gtab = "5"
      var gsheet = "https://spreadsheets.google.com/feeds/list/" +
        gkey + "/" + gtab + "/public/full?alt=json"
      var table1 = document.getElementById("1")
      var table2 = document.getElementById("2")
      var table3 = document.getElementById("3")
      $(document).ready(function() {

        $.getJSON(gsheet, data)

      });

      function data(result) {
        //console.log(result.feed.entry)
        gdata = result.feed.entry;
        process();
        return result;
      }

      function process() {
        table1.innerHTML = "";
        table2.innerHTML = "";
        table3.innerHTML = "";
        gdata.forEach(function(i, index) {
          var upbtn = document.createElement("BUTTON")
          upbtn.setAttribute("onclick", "up(this)")
          upbtn.innerText = "↑"
          upbtn.setAttribute("data-id", index)
          var dwnbtn = document.createElement("BUTTON")
          dwnbtn.setAttribute("onclick", "dwn(this)")
          dwnbtn.setAttribute("data-id", index)
          dwnbtn.innerText = "↓"
          try {
            var tableno = document.getElementById(i.gsx$level.$t)
            var row = tableno.insertRow()
            row.insertCell(0).innerHTML = i.gsx$i.$t
            row.insertCell(1).appendChild(dwnbtn)
            row.insertCell(1).appendChild(upbtn)
            upbtn.class = i.gsx$level.$t;
            dwnbtn.class = i.gsx$level.$t;
          } catch {} finally {}


          //console.log(i)
        });


      }





      function up(that) {

        var level = that.class
        console.log(level)
        level = parseInt(level)
        level--

        var dat = that.getAttribute("data-id")
        //console.log(dat)

        gdata[dat].gsx$level.$t = level;
        process();
        autosave();
      }

      function dwn(that) {

        var level = that.class
        console.log(level)
        level = parseInt(level)
        level++

        var dat = that.getAttribute("data-id")
        //console.log(dat)

        gdata[dat].gsx$level.$t = level;
        process();
        autosave();
      }

      function autosave() {

        $("#myinput").val(JSON.stringify(gdata))
        $("#myform").submit()
       
      }

      function add() {
        var additem = {
          "gsx$i": {
            $t: $("input").val()
          },
          "gsx$level": {
            $t: "2"
          }


        }
        //console.log(additem)
        gdata.push(additem)
        //console.log(gdata)
        autosave();
        process();
 $("input").val("")
      }

    </script>

    <form id="myform" action="https://script.google.com/macros/s/AKfycbw9AU-C4EW_G790ffPGWplypOvGBehxtXj5VFf2wr_KS_GutyM-/exec" method="post" target="dummy">
      <input type="hidden" id="myinput" name="one">

    </form>


    <iframe name="dummy" style="display: none;"></iframe>
  </body>

</html>
